# 15 HTTP, URL, JSON, API
## HTTP
HyperText Transfer Protocol представляет собой набор правил, которые логически определяют, как компьютеры могут отправлять/получать гипертекстовые документы и используется в двух основных случаях:
+ HTTP-сообщение отправляется открытым текстом, передаваемая информация может быть легко перехвачена и расшифрована.
+ По умолчанию HTTP-запросы отправляются на порт 80.
## HTTPS
HyperText Transfer Protocol Secure - расширение HTTP, использующее шифрование для повышения уровня безопасности передачи данных:
+ Сообщения HTTPS шифруются.
+ Шифрование требует времени и вычислительных ресурсов, поэтому HTTPS обычно работает медленнее, чем HTTP.
+ HTTPS-запросы по умолчанию отправляются на порт 443.

Для шифрования информации, передаваемой по протоколу HTTPS, на сервере должен быть установлен так называемый сертификат SSL (Secure Sockets Layer) или TLS (Transport Layer Security, улучшенная версия SSL). Сертификат SSL/TLS состоит из двух частей: открытого ключа, используемого для шифрования данных, и закрытого ключа, используемого для их расшифровки и видимого только для вашего сайта. Практически, ключи представляют собой пару уникальных текстовых файлов, созданных вместе и выглядящих для пользователя как набор непонятных символов. Чтобы сгенерировать такую пару, необходимо отправить запрос на подписание сертификата (CSR) в специальную организацию - центр сертификации (CA), сообщив ему о назначении вашего сайта, названии организации и т. д. Запрос имеет специальный формат и может быть автоматически сгенерирован специальными программами.

HTTP (и HTTPS) - протоколы без состояния (stateless protocol). С точки зрения сервера, каждый новый запрос как будто поступает от совершенно нового клиента (сервер не помнит, что вы только что были на предыдущей странице или авторизовались). Чтобы обеспечить и согласованность запросов, используются:
+ Cookies (куки): Маленькие файлы, которые сервер отправляет браузеру клиента, и которые затем отправляются обратно серверу с каждым последующим запросом. Таким образом, сервер может "узнавать" клиента и отслеживать его действия.
+ Сессии (sessions): Сервер может создавать уникальные идентификаторы сессий для каждого пользователя, которые сохраняются в куки или в URL. Эти идентификаторы позволяют серверу связывать текущий запрос с предыдущими запросами от того же клиента.
+ Заголовки HTTP (HTTP headers): В HTTP-заголовках могут передаваться дополнительные данные, которые помогают серверу идентифицировать и отслеживать клиента. Например, заголовок Authorization может содержать токен, который сервер использует для проверки прав доступа клиента.
### URL, URN, URI
Цель HTTP-запроса - ресурс. Существует 3 типа идентификаторов ресурса в Интернете:
1. URL (Uniform Resource Locator): Протокол + хост + порт + путь к сайту
2. URI (Uniform Resource Identifier): URL + указатель на конкретный ресурс на сайте
3. Термин URN (Uniform Resource Name) имеет два значения:
   1. Иногда URN означает URL без протокола.
   2. Чаще - это уникальная идентификация ресурса в определенном пространстве (книги, RFC и т.д.), в специальном пространстве, начинающемся с urn: ```urn:ietf:rfc:7230``` (серверы реализуют mapping между представлением URN и URL)

Приведенная ниже схема иллюстрирует связь между URI, URL и URN в первом понимании.

<img src="resources/url_NOPROCESS_.png" alt="связь между URI, URL и URN" width="70%"/>

### Структура URL
<img src="resources/url_NOPROCESS1_.png" alt="Структура URL" width="70%"/>

1. Протокол (protocol) - набор правил, которые необходимо использовать для доступа к ресурсу. Это может быть:
   1. HTTP
   2. HTTPS
   3. FTP и другие
2. Хост (host) - Адрес сервера - www.nexus.oy...- - это как строка "город-улица-здание" в физическом адресе. Он может быть представлен в виде:
   1. слов, разделенных точками (например, mentorpiece.education или nexus.oy.defects.tst) - каждое слово является уровнем домена
   2. цифр, разделенные точками, в данном случае это IP-адрес (например, 192.168.40.100/)
   3. localhost (означает локальный компьютер, IP-адрес по умолчанию - 127.0.0.1)
4. Порт (port)- Целевое приложение "слушает" этот порт и обрабатывает соответствующие запросы - 8079 - это как номер квартиры внутри здания
   1. Порт по умолчанию для протокола HTTP - 80
   2. Порт по умолчанию для протокола HTTPS - 443
   3. Порт по умолчанию для протокола FTP (opens in a new tab) - 21
   4. Порт по умолчанию для почтового протокола (SMTP)  - 587
5. Путь (path)- путь к ресурсу - /service/rest/v1/search - рассматривайте его как путь к комнате внутри этой квартиры. Это может быть:
   1. Ресурс в Интернете
   2. Сигнатура API-метода /api/v0/airports
6. Параметры (parameters) - некоторые значения для модификации запроса - ?sort=version и ?direction=desc - воспринимайте это как вопрос типа "Есть ли у вас в комнате такая книга?".

*Примечание:*
+ URL чаще встречаются в повседневной работе в Интернете, поскольку они используются для доступа к веб-ресурсам
+ URN встречаются реже, но служат конкретной цели обеспечения постоянных и независимых от местоположения идентификаторов ресурсов, что делает их ценными в некоторых специализированных областях, где стабильность и уникальность ресурсов имеют первостепенное значение.
### Методы HTTP
HTTP определяет типы запросов, которые могут быть отправлены от клиента к серверу. Эти типы называются HTTP-методами:
+ ``GET`` - используется для чтения данных с сервера
+ ```POST``` - используется для создания чего-либо на стороне сервера. Например, создать новую учетную запись пользователя.
+ ```PUT``` - используется для полного обновления ресурса (клиент должен отправить полный набор данных ресурса, даже если необходимо изменить только одну часть ресурса). Он заменяет весь текущий ресурс на сервере новыми данными, переданными в запросе. ```PUT``` является идемпотентным методом. Это означает, что повторный вызов PUT с одинаковыми данными приведет к одному и тому же результату, не изменяя ресурс повторно
+ ```DELETE``` - что-то удалить.
+ ```PATCH``` - используется для частичного обновления ресурса. Он вносит изменения только в те части ресурса, которые указаны в запросе. ```PATCH``` может быть неидемпотентным, что означает, что повторные вызовы могут привести к различным результатам
+ ```HEAD``` - аналогично ```GET```, но возвращаются только заголовки ответа (некоторая метаинформация) (без данных).
+ ```OPTIONS``` - метод не выполняет никаких изменений и не возвращает данные ресурса; вместо этого он возвращает информацию о том, какие методы HTTP и другие параметры коммуникации поддерживаются. Метод ```OPTIONS``` широко используется в механизме CORS для выполнения предварительных запросов (preflight requests). Когда браузер делает запрос к ресурсу на другом домене, сначала отправляется запрос OPTIONS для проверки разрешений. Ответ на этот запрос включает информацию о том, разрешен ли доступ и какие методы и заголовки допустимы. Пример предварительного запроса (preflight request):
```console
OPTIONS /api/resource HTTP/1.1
Host: api.example.com
Origin: http://www.example.com
Access-Control-Request-Method: POST
Access-Control-Request-Headers: X-Custom-Header
```
Пример ответа на предварительный запрос:
```console
HTTP/1.1 200 OK
Access-Control-Allow-Origin: http://www.example.com
Access-Control-Allow-Methods: POST, GET, OPTIONS
Access-Control-Allow-Headers: X-Custom-Header
```
+ ```CONNECT``` - используется для установления туннеля связи между клиентом и целевым сервером через промежуточный сервер (создание туннелей для HTTPS, для создания туннелей для VPN-соединений и других туннельных протоколов, где требуется передача данных через защищенный канал).
+ ```TRACE``` - используется для диагностики, отладки сетевых соединений, отладка прокси-серверов и шлюзов, проверка целостности запроса. Он позволяет клиенту отправить запрос на сервер и получить в ответе точную копию этого запроса. Это помогает определить, какие изменения или модификации были внесены в запрос при его прохождении через различные промежуточные узлы (прокси-серверы, шлюзы и т.д.). Метод TRACE может представлять угрозу безопасности, так как он возвращает клиенту всю информацию запроса, включая возможные конфиденциальные данные и заголовки. Это может быть использовано злоумышленниками для проведения атак, таких как Cross-Site Tracing (XST). Многие веб-серверы и прокси-серверы по умолчанию отключают поддержку метода TRACE или ограничивают его использование для повышения безопасности.
#### CRUD
Четыре метода (```GET```, ```POST```, ```PUT```, ``DELETE``) называют ``CRUD``: CREATE-READ-UPDATE-DELETE (где READ относится к GET).
### HTTP Запрос/Ответ
<img src="resources/Req_resp_NOPROCESS_.png" alt="Структура запроса и ответа HTTP" width="70%"/>

### Коды состояния HTTP
+ 200 OK. Все в порядке, вот содержимое запрашиваемой страницы.
+ 201 Created (201 Создано). Запрашиваемый ресурс успешно создан.
+ 301 Moved Permanently. (301 Перемещено навсегда) Ресурс с этим URI навсегда перемещен по адресу, указанному в заголовках на стороне сервера.
+ 302 Moved Temporarily. (301 Перемещено временно) Аналогично, но перемещено временно. Часто 301 и 302 означают одно и то же, это зависит от настроек веб-сервера (или веб-приложения). Так что основная идея кодов
+ 301/302 - "эй, просто возьмите новый адрес и перейдите туда".
+ 304 Not Modified. (304 Не изменен) Если был использован заголовок клиента "If-Modified-Since" (если изменен, то...) и ресурс не был изменен, то нет необходимости получать его снова.
+ 400 Bad Request. (400 Ошибочный запрос) Что-то не так с вашим запросом.
+ 401 Unauthorized. (401 Неавторизованный) Вы должны быть авторизованы, чтобы открыть этот URI. Когда сервер отвечает этим кодом, он также показывает вам форму авторизации для ввода логина и пароля.
+ 403 Forbidden. (403 Запрещено) Доступ запрещен. Показывается, например, когда введены неправильные логин и/или пароль.
+ 404 Not found. (404 Не найдено) Ресурс с таким URI не существует (или сервер хочет, чтобы вы так думали).
+ 418 I’m a teapot. (418 Я чайник) Код из первоапрельской шутки, на самом деле не должен работать.
+ 500 Internal Server Error. (500 Внутренняя ошибка сервера) Что-то не так с сервером.
+ 502 Bad Gateway. (502 Неудачное перенаправление) Сервер попытался перенаправить ваш запрос на другой сервер, но не преуспел в этом.
+ 503 Service Unavailable. (503 Сервер недоступен) По сути, то же самое, что 500.
+ 504 Gateway Timeout. (504 Таймаут шлюза) То же самое, что и 502, но в случае ошибки тайм-аута.
### Заголовки HTTP
Вторая часть HTTP-запроса или ответа - раздел заголовков.
#### Заголовки запросов
##### General Headers (Общие заголовки):
+ ```Host```: Указывает доменное имя и порт сервера, к которому обращается клиент.
+ ```Connection```: Управляет параметрами текущего соединения. Например, ```Connection: keep-alive``` сохраняет соединение открытым для последующих запросов.
+ ```Cache-Control```: Управляет кешированием запросов. Например, ```Cache-Control: no-cache```.
##### Request Headers (Заголовки запросов):
+ ```Accept```: Указывает типы медиа, которые клиент может обработать. Например, ```Accept: text/html```.
+ ```User-Agent```: Идентифицирует клиентское приложение. Например, ```User-Agent: Mozilla/5.0```.
+ ```Accept-Language```: Указывает предпочтительные языки. Например, ```Accept-Language: en-US```.
+ ```Authorization```: Передает учетные данные для аутентификации. Например, ```Authorization: Basic YWxhZGRpbjpvcGVuc2VzYW1l```.
##### Entity Headers (Заголовки сущностей):
+ ```Content-Type```: Указывает MIME-тип тела запроса. Например, ```Content-Type: application/json```.
+ ```Content-Length```: Указывает длину тела запроса в байтах. Например, ```Content-Length: 348```.
#### Заголовки ответов
##### General Headers (Общие заголовки):
+ ```Date```: Указывает дату и время, когда сервер сгенерировал ответ. Например, ```Date: Wed, 12 Jun 2024 15:00:00 GMT```.
##### Response Headers (Заголовки ответов):
+ ```Server```: Идентифицирует серверное программное обеспечение. Например, ```Server: Apache/2.4.1 (Unix)```.
+ ```Set-Cookie```: Устанавливает cookie в браузере. Например, ```Set-Cookie: sessionId=abc123; Path=/; Secure; HttpOnly```.
+ ```WWW-Authenticate```: Указывает метод аутентификации, требуемый для доступа к ресурсу. Например, ```WWW-Authenticate: Basic realm="Access to the site"```.
##### Entity Headers (Заголовки сущностей):
+ ```Content-Type```: Указывает MIME-тип тела ответа. Например, ```Content-Type: text/html; charset=UTF-8```.
+ ```Content-Length```: Указывает длину тела ответа в байтах. Например, ```Content-Length: 348```.
+ ```Content-Encoding```: Указывает кодировку, использованную для сжатия тела. Например, ```Content-Encoding: gzip```.
#### Другие важные заголовки
+ ```Referer```: Указывает URL, с которого был сделан запрос. Например, ```Referer: https://www.example.com```.
+ ```Location```: Используется для перенаправлений, указывает новый URL. Например, ```Location: https://www.example.com/newpage```.
+ ```Transfer-Encoding```: Управляет фрагментацией тела сообщения. Например, ```Transfer-Encoding: chunked```.
+ ```X-Content-Type-Options```: Указывает браузеру не изменять MIME-тип. Например, ```X-Content-Type-Options: nosniff```.
+ ```Strict-Transport-Security```: Указывает политику безопасности для HTTPS. Например, ```Strict-Transport-Security: max-age=31536000```.

*Примечание:*
Существуют пользовательские заголовки, поддерживаемые только конкретным приложением. Например, вы можете отправить в запросе заголовок x-correlation-id, и ваш сервер должен знать, как обработать этот заголовок.
### Тело HTTP-запроса/ответа
HTTP-запрос/ответ может содержать полезную нагрузку, которая помещается в часть Request или Response Body. Тело ответа может содержать:
+ исходный код веб-страницы или только что созданные 
+ данные учетной записи пользователя, например, в формате JSON
+ различные типы данных (медиатипы в соответствии со стандартом): аудио, изображение, текст и так далее. При выполнении запроса (PUT, POST) тип данных задается с помощью заголовка ```Content-type```:
  + ```Content-Type: text/html; charset=utf-8```
Архитектурный стиль REST

REST — это стиль архитектуры программного обеспечения, определяющий набор правил, ограничений, рекомендаций для разработки веб-приложений (в основном веб-служб и API). В основе REST лежит HTTP: он определяет способы, с помощью которых клиент создаёт ресурсы на стороне сервера и получает доступ к ним.	

Примеры для GET:
	Получение информации о ресурсе - GET /api/users/123
	Получение списка ресурсов - GET /api/products
	Фильтрация результатов - GET /api/products?category=electronics
	Пагинация результатов - GET /api/posts?page=2&pageSize=10
	Получение подробностей о ресурсе - GET /api/articles/456/details
	Получение ресурса с использованием путей - GET /api/countries/usa/cities/new-york
	Получение коллекции связанных ресурсов - GET /api/articles/123/comments

Программный интерфейс API - набор правил взаимодействия с конкретным приложением. 

Веб-ориентированные API:
	- SOAP 
	- REST
	- GraphQL

Документация для API
	классическая (таблицы и тексты)
	динамическая (Swagger, OpenAPI)

